-- bmb-testing: Testing framework for BMB programs
-- Provides assertion utilities and test runner support

-- Test result codes
fn result_pass() -> i64 = 0;
fn result_fail() -> i64 = 1;
fn result_skip() -> i64 = 2;

-- Assertion: check equality
fn assert_eq(actual: i64, expected: i64) -> bool =
    if actual == expected then true
    else {
        let u0 = print_string("FAIL: expected ");
        let u1 = print_i64(expected);
        let u2 = print_string(" but got ");
        let u3 = println(actual);
        false
    };

-- Assertion: check not equal
fn assert_ne(actual: i64, unexpected: i64) -> bool =
    if actual != unexpected then true
    else {
        let u0 = print_string("FAIL: expected different from ");
        let u1 = println(unexpected);
        false
    };

-- Assertion: check true
fn assert_true(condition: bool) -> bool =
    if condition then true
    else {
        let u0 = println_string("FAIL: expected true");
        false
    };

-- Assertion: check false
fn assert_false(condition: bool) -> bool =
    if not condition then true
    else {
        let u0 = println_string("FAIL: expected false");
        false
    };

-- Assertion: check greater than
fn assert_gt(actual: i64, threshold: i64) -> bool =
    if actual > threshold then true
    else {
        let u0 = print_string("FAIL: expected ");
        let u1 = print_i64(actual);
        let u2 = print_string(" > ");
        let u3 = println(threshold);
        false
    };

-- Assertion: check greater than or equal
fn assert_gte(actual: i64, threshold: i64) -> bool =
    if actual >= threshold then true
    else {
        let u0 = print_string("FAIL: expected ");
        let u1 = print_i64(actual);
        let u2 = print_string(" >= ");
        let u3 = println(threshold);
        false
    };

-- Assertion: check less than
fn assert_lt(actual: i64, threshold: i64) -> bool =
    if actual < threshold then true
    else {
        let u0 = print_string("FAIL: expected ");
        let u1 = print_i64(actual);
        let u2 = print_string(" < ");
        let u3 = println(threshold);
        false
    };

-- Assertion: check less than or equal
fn assert_lte(actual: i64, threshold: i64) -> bool =
    if actual <= threshold then true
    else {
        let u0 = print_string("FAIL: expected ");
        let u1 = print_i64(actual);
        let u2 = print_string(" <= ");
        let u3 = println(threshold);
        false
    };

-- Assertion: check in range [min, max]
fn assert_in_range(actual: i64, min_val: i64, max_val: i64) -> bool
  pre min_val <= max_val
= if actual >= min_val and actual <= max_val then true
  else {
      let u0 = print_string("FAIL: expected ");
      let u1 = print_i64(actual);
      let u2 = print_string(" in range [");
      let u3 = print_i64(min_val);
      let u4 = print_string(", ");
      let u5 = print_i64(max_val);
      let u6 = println_string("]");
      false
  };

-- Test summary tracking
fn count_passed(results: i64, total: i64) -> i64 = results;

fn report_summary(passed: i64, total: i64) -> i64 = {
    let u0 = print_string("\n--- Test Summary ---\n");
    let u1 = print_string("Passed: ");
    let u2 = print_i64(passed);
    let u3 = print_string("/");
    let u4 = println(total);
    let u5 = if passed == total then println_string("All tests passed!")
             else println_string("Some tests failed.");
    if passed == total then 0 else 1
};

-- Simple test runner helper
fn run_test(name_code: i64, result: bool) -> i64 = {
    let status = if result then "PASS" else "FAIL";
    let u0 = print_string("[");
    let u1 = print_string(status);
    let u2 = print_string("] Test ");
    let u3 = println(name_code);
    if result then 1 else 0
};
